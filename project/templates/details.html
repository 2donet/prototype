{% extends "base.html" %}
{% block title %}
2do.net - {{ content.name }}
{% endblock %}
{% block projecttitle %}
To do Network: {{ content.name}}{% endblock %}
{% block content %}
{% load static %}
{% load humanize %}
{% load project_filters %}

<div class="grid2">
    
    <div class="pcard">
        {% if can_moderate %}
        <div class="moderation-alert">
            <div class="alert-content">
                <i class="material-icons" style="color: aliceblue !important;">security</i>
                <div class="alert-text">
                    <h6>Project Moderation</h6>
                    <p>Manage and moderate all aspects of this project.</p>
                </div>
                <a href="{% url 'project:moderation_dashboard' content.id %}" class="btn waves-effect waves-light red">
                    <i class="material-icons left">security</i>
                    Dashboard
                </a>
                <a href="{% url 'submissions:submission_list' 'project' content.id %}" class="btn blue">
                    View Submissions ({{ project.submissions.count }})
                </a>
            </div>
    
        </div>
        {% endif %}

        <div class="box">
    
            <h2>{{ content.name }}</h2>            <a href="{% url 'submissions:create_submission_for_content' 'project' content.id %}"
                class="btn blue waves-effect waves-light">
                <i class="material-icons left">assignment</i>Apply Now
            </a>
            <div class="chips" style="border-bottom: none;">
                {% for skill in content.skills.all %}
                <a href="{% url 'skill_detail' skill.id %}" class="chip">
                    {{ skill.name }}
                </a>
                {% empty %}
                <p>No skills added yet.</p>
                {% endfor %}
            </div>
    
            <blockquote style="border-left: 5px solid #e5c129;">
                {{ content.summary|default_if_none:" " }}
            </blockquote>
                    <h5>Locations</h5>
                {% include "components/localizations.html" %}
            <div class="section">
    
    
                {% if can_moderate and content|has_pending_connection_requests %}
                <div class="card amber lighten-4" style="margin-bottom: 20px;">
                    <div class="card-content">
                        <span class="card-title amber-text text-darken-2">
                            <i class="material-icons left">notification_important</i>
                            Connection Requests Pending
                            <span class="new badge amber" data-badge-caption="">{{ content|pending_connection_requests_count
                                }}</span>
                        </span>
                        <p>
                            You have {{ content|pending_connection_requests_count }} project{{
                            content|pending_connection_requests_count|pluralize }}
                            requesting to connect as subproject{{ content|pending_connection_requests_count|pluralize }}.
                        </p>
                        <a href="{% url 'project:subprojects_management' content.id %}"
                            class="btn amber darken-2 white-text waves-effect waves-light">
                            <i class="material-icons left">settings</i>
                            Review Requests
                        </a>
                    </div>
                </div>
                {% endif %}
                <h5>Intros</h5>
                <a href="{% url 'intros:create' 'project' project.id %}" class="btn">
                    <i class="material-icons left">add</i>Create Introduction
                </a>
                <a href="{% url 'intros:link' 'project' project.id %}" class="btn-secondary">
                    <i class="material-icons left">link</i>Link Existing
                </a>
                
                    {% if intros %}
                    <div class="row">
                        <ul>
                                {% for intro in intros %}
                                <li><a href="{% url 'intros:detail' intro.id%}">{{intro.name}}</a> - {{intro.summary}}</li>
                                {% endfor %}
                            </ul>
                    </div>

                    {% endif %}

    
    
                {% if content.desc %}
                <div class="project-description-card">
                    <h5 class="section-title">
                        <i class="material-icons left" style="color: aliceblue !important;">description</i>
                        Project Description
                    </h5>
                    <div class="description-content">
                        {{ content.desc|linebreaks }}
                    </div>
                </div>
                {% endif %}
            </div>
            <br>
    



    
            <h5>Plans</h5>
            {% include "components/plans.html" %}
        </div>
        <h5>Tasks</h5>
        {% include "components/tasks.html" %}
        <h5>Needs</h5>
        {% include "components/needs.html"%}
        <h5>Problems</h5>
        {% include "components/problems.html" with problems=problems can_contribute=can_contribute %}
    
    
    </div>

    <div class="pinfo">
        {% include "components/hero.html" %}
                {% include "components/administrationcard.html" %}

        {% include "components/connection.html" %}

<div class="creator-info">
    {% if project.created_by %}
        <div class="creator-header">
            <div class="creator-avatar">
                {% if project.created_by.profile.avatar %}
                    <a href="{% url 'user:userprofile' project.created_by.id %}"><img  src="{{ project.created_by.profile.avatar_thumbnail.url }}" alt="{{ project.created_by.username }}" class="circle responsive-img"></a>
                {% else %}
                    <img src="{% static 'icons/default-avatar.svg' %}" alt="{{ project.created_by.username }}" class="circle responsive-img">
                {% endif %}
            </div>
            <div class="creator-details">
                <h6>Created by</h6>
                <a href="{% url 'user:userprofile' project.created_by.id %}" class="creator-name">
                    {{ project.created_by.get_full_name|default:project.created_by.username }}<a href="/messages/{{ project.created_by.username }}/"> ‚úâÔ∏è </a>

                </a>
            </div>
        </div>
        
        {% if project.created_by.profile.bio %}
            <blockquote class="creator-bio">
                {{ project.created_by.profile.bio|linebreaks }}
            </blockquote>
        {% else %}
            <blockquote class="creator-bio no-bio">
                <em>This user hasn't written a bio yet.</em>
            </blockquote>
        {% endif %}
        
        <!-- Additional creator info -->
        <div class="creator-meta">
            {% if project.created_by.profile.location %}
                <div class="creator-location">
                    <i class="material-icons tiny">location_on</i>
                    <span>{{ project.created_by.profile.location }}</span>
                </div>
            {% endif %}
            
            {% if project.created_by.profile.website %}
                <div class="creator-website">
                    <i class="material-icons tiny">link</i>
                    <a href="{{ project.created_by.profile.website }}" target="_blank" rel="noopener">
                        {{ project.created_by.profile.website|truncatechars:30 }}
                    </a>
                </div>
            {% endif %}
            
            <div class="creator-joined">
                <i class="material-icons tiny">calendar_today</i>
                <span>Joined {{ project.created_by.date_joined|date:"M Y" }}</span>
            </div>
        </div>
    {% else %}
        <blockquote class="creator-bio no-creator">
            <em>Creator information not available.</em>
        </blockquote>
    {% endif %}


</div>
<!-- enhanced subproj -->
{% include "components/enhanced_subprojects.html" %}
<!-- enh sub -->


        <br>
        <!-- users should be able to add tags. verified user with a rep > N can flag project by clicking tags on left of the screen -->



        <div class="members-container card">
            {% include "components/join_or_leave.html" %}
<div class="card-content">
    <span class="card-title">üë• Project Members</span>
    {% if can_manage_members %}
    <div class="right-align" style="margin-bottom: 20px;">
        <a href="{% url 'project:project_members' content.id %}" class="btn waves-effect waves-light blue">
            <i class="material-icons left">group</i>Manage Members
        </a>
        <a href="{% url 'project:add_member' content.id %}" class="btn waves-effect waves-light green">
            <i class="material-icons left">person_add</i>Add Member
        </a>
    </div>
    {% endif %}
    
    <!-- Administrators group -->
    <details open>
        <summary class="user-group-summary">
            <span class="user-group-title">üëë Administrators</span>
            <span class="user-count">{{ admin_users|length }}</span>
        </summary>
        <div class="user-group-content">
            <p class="user-group-desc">Project administrators have full control over the project, including managing members and settings.</p>
            
            <ul class="user-list">
                {% for user in admin_users %}
                <li class="user-item">
                    <div class="user-info">
                        {% if user.profile.avatar %}
                            <img class="user-avatar circle" src="{{ user.profile.avatar_small.url }}" alt="{{ user.username }}">
                        {% else %}
                            <img class="user-avatar circle" src="{% static 'icons/default-avatar.svg' %}" alt="{{ user.username }}">
                        {% endif %}
                        
                        <div class="user-details">
                            <span class="user-name">{{ user.get_full_name|default:user.username }}</span>
                            <span class="user-joined">Joined {{ user.date_joined|naturaltime }}</span>
                            {% if user.profile.location %}
                                <span class="user-location">
                                    <i class="material-icons tiny">location_on</i>
                                    {{ user.profile.location }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="user-actions dropdown-trigger" data-target="admin-actions-{{ user.id }}">
                        <span class="user-menu-icon">‚ãÆ</span>
                    </div>
                    
                    <ul id="admin-actions-{{ user.id }}" class="dropdown-content">
                        <li><a href="{% url 'user:userprofile' user.id %}">üßë Profile</a></li>
                        <li><a href="{% url 'project:member_detail' content.id user.id %}">üë• Membership Details</a></li>
                        <li><a href="/messages/{{ user.username }}/">‚úâÔ∏è Message</a></li>
                        <li><a href="/reward/{{ user.id }}/">üéÅ Reward</a></li>
                        <li><a href="/report/user/{{ user.id }}/">üö© Report</a></li>
                    </ul>
                </li>
                {% empty %}
                <li class="empty-list-message">No administrators found</li>
                {% endfor %}
            </ul>
        </div>
    </details>
    
    <!-- Moderators group -->
    <details>
        <summary class="user-group-summary">
            <span class="user-group-title">üõ°Ô∏è Moderators</span>
            <span class="user-count">{{ moderator_users|length }}</span>
        </summary>
        <div class="user-group-content">
            <p class="user-group-desc">Moderators help manage project content and comments.</p>
            
            <ul class="user-list">
                {% for user in moderator_users %}
                <li class="user-item">
                    <div class="user-info">
                        {% if user.profile.avatar %}
                            <img class="user-avatar circle" src="{{ user.profile.avatar_small.url }}" alt="{{ user.username }}">
                        {% else %}
                            <img class="user-avatar circle" src="{% static 'icons/default-avatar.svg' %}" alt="{{ user.username }}">
                        {% endif %}
                        
                        <div class="user-details">
                            <span class="user-name">{{ user.get_full_name|default:user.username }}</span>
                            <span class="user-joined">Joined {{ user.date_joined|naturaltime }}</span>
                            {% if user.profile.location %}
                                <span class="user-location">
                                    <i class="material-icons tiny">location_on</i>
                                    {{ user.profile.location }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="user-actions dropdown-trigger" data-target="mod-actions-{{ user.id }}">
                        <span class="user-menu-icon">‚ãÆ</span>
                    </div>
                    
                    <ul id="mod-actions-{{ user.id }}" class="dropdown-content">
                        <li><a href="{% url 'user:userprofile' user.id %}">üßë Profile</a></li>
                        <li><a href="{% url 'project:member_detail' content.id user.id %}">üë• Membership Details</a></li>
                        <li><a href="/message/{{ user.username }}/">‚úâÔ∏è Message</a></li>
                        <li><a href="/reward/{{ user.id }}/">üéÅ Reward</a></li>
                        <li><a href="/report/user/{{ user.id }}/">üö© Report</a></li>
                    </ul>
                </li>
                {% empty %}
                <li class="empty-list-message">No moderators found</li>
                {% endfor %}
            </ul>
        </div>
    </details>
    
    <!-- Contributors group -->
    <details>
        <summary class="user-group-summary">
            <span class="user-group-title">üî® Contributors</span>
            <span class="user-count">{{ contributor_users|length }}</span>
        </summary>
        <div class="user-group-content">
            <p class="user-group-desc">Contributors actively help build and develop the project.</p>
            
            <ul class="user-list">
                {% for user in contributor_users %}
                <li class="user-item">
                    <div class="user-info">
                        {% if user.profile.avatar %}
                            <img class="user-avatar circle" src="{{ user.profile.avatar_small.url }}" alt="{{ user.username }}">
                        {% else %}
                            <img class="user-avatar circle" src="{% static 'icons/default-avatar.svg' %}" alt="{{ user.username }}">
                        {% endif %}
                        
                        <div class="user-details">
                            <span class="user-name">{{ user.get_full_name|default:user.username }}</span>
                            <span class="user-joined">Joined {{ user.date_joined|naturaltime }}</span>
                            {% if user.profile.location %}
                                <span class="user-location">
                                    <i class="material-icons tiny">location_on</i>
                                    {{ user.profile.location }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                
                    <div class="user-actions dropdown-trigger" data-target="contrib-actions-{{ user.id }}">
                        <span class="user-menu-icon">‚ãÆ</span>
                    </div>
                
                    <ul id="contrib-actions-{{ user.id }}" class="dropdown-content">
                        <li><a href="{% url 'user:userprofile' user.id %}">üßë Profile</a></li>
                        <li><a href="{% url 'project:member_detail' content.id user.id %}">üë• Membership Details</a></li>
                        <li><a href="/message/{{ user.username }}/">‚úâÔ∏è Message</a></li>
                        <li><a href="/reward/{{ user.id }}/">üéÅ Reward</a></li>
                        <li><a href="/report/user/{{ user.id }}/">üö© Report</a></li>
                    </ul>
                </li>
                {% empty %}
                <li class="empty-list-message">No contributors found</li>
                {% endfor %}
            </ul>
        </div>
    </details>
    
    <!-- Members/Supporters group - Updated to match admin/moderator style -->
    <details>
        <summary class="user-group-summary">
            <span class="user-group-title">üë• Members</span>
            <span class="user-count">{{ member_users|length }}</span>
        </summary>
        <div class="user-group-content">
            <p class="user-group-desc">Project members who follow and support the project.</p>
            
            <ul class="user-list">
                {% for user in member_users %}
                <li class="user-item">
                    <div class="user-info">
                        {% if user.profile.avatar %}
                            <img class="user-avatar circle" src="{{ user.profile.avatar_small.url }}" alt="{{ user.username }}">
                        {% else %}
                            <img class="user-avatar circle" src="{% static 'icons/default-avatar.svg' %}" alt="{{ user.username }}">
                        {% endif %}
                        
                        <div class="user-details">
                            <span class="user-name">{{ user.get_full_name|default:user.username }}</span>
                            <span class="user-joined">Joined {{ user.date_joined|naturaltime }}</span>
                            {% if user.profile.location %}
                                <span class="user-location">
                                    <i class="material-icons tiny">location_on</i>
                                    {{ user.profile.location }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="user-actions dropdown-trigger" data-target="member-actions-{{ user.id }}">
                        <span class="user-menu-icon">‚ãÆ</span>
                    </div>
                    
                    <ul id="member-actions-{{ user.id }}" class="dropdown-content">
                        <li><a href="{% url 'user:userprofile' user.id %}">üßë Profile</a></li>
                        <li><a href="{% url 'project:member_detail' content.id user.id %}">üë• Membership Details</a></li>
                        <li><a href="/message/{{ user.username }}/">‚úâÔ∏è Message</a></li>
                        <li><a href="/reward/{{ user.id }}/">üéÅ Reward</a></li>
                        <li><a href="/report/user/{{ user.id }}/">üö© Report</a></li>
                    </ul>
                </li>
                {% empty %}
                <li class="empty-list-message">No members found</li>
                {% endfor %}
            </ul>
        </div>
    </details>
</div>




        </div>



    </div>



    <div class="pcom">
        <ul class="tabs">
            <li class="tab"><a href="#comments" class="active">Comments</a></li>
            <li class="tab"><a href="#contribs">Contribs</a></li>
            <li class="tab"><a href="#rewards">Rewards</a></li>
        </ul>


        <div id="contribs">
            contribs
        </div>
        <div id="rewards">
            rewards
        </div>
        <div id="comments" class="newcomments">


            
            <div>
                {% if comments %}
                <div class="input-field col s12">
                    <select>
                        <option value="" disabled>Sorting by</option>
                        <option value="0" selected>Highest reviews</option>
                        <option value="1">Lowest reviews</option>
                        <option value="2">Newest</option>
                        <option value="3">Oldest</option>
                    </select>

                    <label>Sorting by</label>

                </div>
                <label>
                    <input type="checkbox" class="filled-in"  />
                    <span>Show comments from anonymous Users</span>
                  </label>

                {% include "comments.html" with comments=comments %}
                {% else %}
                <p>No comments</p>
                {% endif %}
                <form id="add-comment-form" method="post">
                    {% csrf_token %}
                    <textarea name="content" placeholder="Add a comment..."></textarea>
                    <input type="hidden" name="to_project_id" value="{{ content.id }}">
                    <button type="submit">Submit</button>
                </form>
            </div>

            <br>

        </div>
    </div>

</div>




<!--    <script src="{% static 'project/js/script.js' %}"></script>-->



 
<style>
.user-group-summary {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 20px;
    background: var(--bg-color3);
    border-radius: 8px;
    margin: 15px 0 10px 0;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 4px solid var(--highlight);
}

.user-group-summary:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
}

.user-group-title {
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
}

.user-count {
    background-color: var(--highlight);
    color: var(--highlightdark);
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 700;
    min-width: 30px;
    text-align: center;
}

.user-group-content {
    margin: 0 10px 15px 10px;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: all 0.3s ease;
}

details[open] .user-group-content {
    opacity: 1;
    max-height: none;
    margin: 10px 10px 20px 10px;
}

.user-group-desc {
    color: var(--text2ndary);
    font-size: 0.9rem;
    margin: 10px 0 15px 0;
    line-height: 1.5;
    padding: 10px;
    background-color: var(--bg-color2);
    border-radius: 6px;
}

.user-list {
    list-style: none;
    padding: 0;
    margin: 10px 0;
}

.user-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    margin: 8px 0;
    background-color: var(--bg-color3);
    border-radius: 8px;
    transition: all 0.3s ease;
}

.user-item:hover {
    background-color: var(--bg-light);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.user-avatar {
    width: 45px;
    height: 45px;
    object-fit: cover;
    border: 2px solid var(--bg-color2);
    border-radius: 50%;
}

.user-details {
    display: flex;
    flex-direction: column;
    gap: 3px;
}

.user-name {
    font-weight: 600;
    color: var(--text);
    font-size: 0.95rem;
}

.user-joined {
    color: var(--text2ndary);
    font-size: 0.8rem;
}

.user-location {
    color: var(--text2ndary);
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 3px;
}

.user-actions {
    position: relative;
}

.user-menu-icon {
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: background-color 0.3s;
}

.user-menu-icon:hover {
    background-color: rgba(0,0,0,0.1);
}

.empty-list-message {
    color: var(--text2ndary);
    font-style: italic;
    text-align: center;
    padding: 20px;
    background-color: var(--bg-light);
    border-radius: 8px;
    margin: 10px 0;
}

@media (max-width: 600px) {
    .user-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .user-actions {
        width: 100%;
        text-align: right;
    }
}





/* Alert Cards */
.moderation-alert,
.connection-requests-alert {
    background: var(--bg-light);
    border-radius: 8px;
    border-left: 4px solid var(--danger);
    margin-bottom: 20px;
    padding: 0;
    overflow: hidden;
}

.connection-requests-alert {
    border-left-color: var(--warning);
}

.alert-content {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
}

.alert-content i {
    color: var(--danger);
    font-size: 2rem;
    flex-shrink: 0;
}

.connection-requests-alert .alert-content i {
    color: var(--warning);
}

.alert-text {
    flex: 1;
}

.alert-text h6 {
    margin: 0 0 5px 0;
    color: var(--text);
}

.alert-text p {
    margin: 0;
    color: var(--text2ndary);
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize dropdowns
    var dropdowns = document.querySelectorAll('.dropdown-trigger');
    M.Dropdown.init(dropdowns, {
        constrainWidth: false,
        coverTrigger: false,
        alignment: 'right'
    });
});
</script>
<script src="{% static 'comment/comments.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize all dropdowns
        var dropdowns = document.querySelectorAll('.dropdown-trigger');
        var dropdownOptions = {
            constrainWidth: false,
            coverTrigger: false,
            alignment: 'right'
        };
        M.Dropdown.init(dropdowns, dropdownOptions);
        
        // Initialize tabs
        var tabs = document.querySelectorAll('.tabs');
        M.Tabs.init(tabs);
        
        // Initialize select inputs
        var selects = document.querySelectorAll('select');
        M.FormSelect.init(selects);
    });
</script>
{% endblock %}